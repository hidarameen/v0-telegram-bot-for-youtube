# دليل نشر البوت على منصة Render

## المقدمة

هذا الدليل يشرح كيفية نشر بوت التلقرام لرفع الفيديوهات إلى YouTube على منصة Render.com.

## المتطلبات

1. حساب على [Render.com](https://render.com)
2. مستودع Git (GitHub, GitLab, أو Bitbucket)
3. توكن بوت تلقرام
4. بيانات اعتماد Google API
5. قاعدة بيانات PostgreSQL (يمكن إنشاؤها على Render أيضًا)

## خطوات النشر

### 1. إعداد قاعدة البيانات

1. سجل دخول إلى حسابك على Render
2. انتقل إلى "New" ثم اختر "PostgreSQL"
3. أدخل اسم قاعدة البيانات (مثل `youtube-bot-db`)
4. اختر الخطة المناسبة (يمكن استخدام الخطة المجانية للاختبار)
5. انقر على "Create Database"
6. بعد إنشاء قاعدة البيانات، احفظ رابط الاتصال (Internal Database URL)

### 2. نشر البوت

#### الطريقة الأولى: باستخدام Blueprint

1. انقر على الرابط أدناه لنشر البوت مباشرة:
   [Deploy to Render](https://render.com/deploy)

2. اربط مستودع Git الخاص بك
3. أدخل متغيرات البيئة المطلوبة:
   - `TELEGRAM_BOT_TOKEN`: توكن بوت التلقرام
   - `YOUTUBE_CLIENT_ID`: معرف عميل Google
   - `YOUTUBE_CLIENT_SECRET`: سر عميل Google
   - `REDIRECT_URI`: عنوان إعادة التوجيه (استخدم عنوان Render الخاص بك + `/callback`)
   - `DATABASE_URL`: رابط قاعدة البيانات من الخطوة السابقة

4. انقر على "Apply"

#### الطريقة الثانية: إنشاء خدمة يدويًا

1. انتقل إلى "New" ثم اختر "Web Service"
2. اربط مستودع Git الخاص بك
3. أدخل المعلومات التالية:
   - **Name**: youtube-telegram-bot
   - **Environment**: Python
   - **Build Command**: `./build.sh`
   - **Start Command**: `python webhook_bot.py`

4. أضف متغيرات البيئة المطلوبة:
   - `TELEGRAM_BOT_TOKEN`: توكن بوت التلقرام
   - `YOUTUBE_CLIENT_ID`: معرف عميل Google
   - `YOUTUBE_CLIENT_SECRET`: سر عميل Google
   - `REDIRECT_URI`: عنوان إعادة التوجيه (استخدم عنوان Render الخاص بك + `/callback`)
   - `DATABASE_URL`: رابط قاعدة البيانات
   - `PORT`: 10000

5. انقر على "Create Web Service"

### 3. إعداد Webhook

بعد نشر البوت بنجاح، يجب إعداد webhook لتلقي تحديثات التلقرام:

1. انتظر حتى يكتمل النشر وتحصل على عنوان URL للخدمة
2. أضف متغير بيئة جديد:
   - `RENDER_EXTERNAL_URL`: عنوان URL الخاص بالخدمة (مثل `https://youtube-telegram-bot.onrender.com`)

3. قم بتشغيل سكريبت إعداد webhook:
   - انتقل إلى "Shell" في لوحة تحكم الخدمة
   - نفذ الأمر: `python render_webhook.py`

4. تحقق من الحالة:
   - قم بزيارة `https://your-app-url.onrender.com/health`
   - يجب أن ترى رسالة تفيد بأن البوت متصل وصحي

## استكشاف الأخطاء وإصلاحها

### البوت لا يستجيب

1. تحقق من سجلات الخدمة في لوحة تحكم Render
2. تأكد من صحة توكن بوت التلقرام
3. تحقق من إعداد webhook بشكل صحيح

### مشاكل قاعدة البيانات

1. تأكد من صحة رابط قاعدة البيانات
2. تحقق من إمكانية الوصول إلى قاعدة البيانات من الخدمة
3. قم بتشغيل `python database_test.py` للتحقق من الاتصال

### مشاكل المصادقة مع YouTube

1. تأكد من صحة بيانات اعتماد Google API
2. تحقق من إضافة عنوان إعادة التوجيه الصحيح في وحدة تحكم Google Cloud
3. تأكد من تفعيل YouTube Data API v3

## الصيانة

- قم بزيارة لوحة تحكم Render بانتظام للتحقق من حالة الخدمة
- راقب استخدام الموارد لتجنب تجاوز الحدود المجانية
- قم بتحديث البوت عن طريق دفع التغييرات إلى مستودع Git

## ملاحظات هامة

- الخطة المجانية في Render تتوقف بعد فترة من عدم النشاط، لذا قد تحتاج إلى استخدام خدمة مثل [UptimeRobot](https://uptimerobot.com) للحفاظ على الخدمة نشطة
- قم بتعيين `REDIRECT_URI` بشكل صحيح بعد النشر ليتطابق مع عنوان URL الخاص بالخدمة
- تأكد من إضافة عنوان إعادة التوجيه في وحدة تحكم Google Cloud
